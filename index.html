<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Base</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: none; animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .bg-clip-text {
            -webkit-background-clip: text;
            background-clip: text;
        }
        .text-transparent {
            color: transparent;
        }
    </style>
</head>
<body>
    <div
        class="min-h-screen p-4"
        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);"
    >
        <!-- Floating celestial elements -->
        <div class="hidden md:block absolute top-4 left-4 text-white opacity-60 animate-bounce text-2xl" style="animation-delay: 0s;">☁️</div>
        <div class="hidden md:block absolute top-8 right-8 text-white opacity-60 animate-bounce text-xl" style="animation-delay: 1s;">🫧</div>
        <div class="hidden md:block absolute top-16 left-16 text-white opacity-50 animate-bounce text-lg" style="animation-delay: 2s;">✨</div>
        <div class="hidden md:block absolute top-32 right-32 text-white opacity-60 animate-bounce text-xl" style="animation-delay: 1.5s;">🔮</div>

        <div class="max-w-5xl mx-auto py-8">
            <div class="bg-white/95 backdrop-blur-lg rounded-3xl shadow-2xl border-2 border-blue-200 p-6 relative overflow-hidden">
                <!-- Dreamy corner elements -->
                <div class="absolute top-2 left-2 text-purple-400 text-2xl">☁️</div>
                <div class="absolute top-2 right-2 text-sky-400 text-2xl">☁️</div>

                <!-- Header with celestial styling -->
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent mb-2">
                        Knowledge Base 
                    </h1>
                    <div class="flex justify-center gap-2 text-2xl">
                        <span class="animate-pulse">🌙</span>
                        <span class="animate-pulse" style="animation-delay: 0.5s;">✨</span>
                        <span class="animate-pulse" style="animation-delay: 1s;">💫</span>
                    </div>
                    <p class="text-sm text-blue-600 mt-2 font-medium">🌌 Document your processes and procedures</p>
                </div>

                <!-- Add new workflow with cloud theme -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl p-4 mb-8 shadow-lg">
                    <div class="flex gap-3 items-center">
                        <span class="text-2xl">🫧</span>
                        <input
                            type="text"
                            id="newWorkflow"
                            placeholder="Add new workflow..."
                            class="flex-1 px-4 py-3 bg-white/95 border-2 border-white/30 rounded-full focus:outline-none focus:ring-4 focus:ring-white/30 transition-all text-gray-800 placeholder-gray-500"
                        />
                        <button
                            id="addWorkflowBtn"
                            class="px-6 py-3 bg-white text-blue-600 rounded-full hover:bg-blue-50 focus:outline-none focus:ring-4 focus:ring-white/30 transition-all transform hover:scale-105 shadow-lg font-bold"
                        >
                            Add +
                        </button>
                    </div>
                </div>

                <!-- Filter buttons with dreamy cloud theme -->
                <div class="flex gap-3 mb-8 justify-center flex-wrap" id="filterButtons">
                    <button class="filter-btn px-4 py-2 rounded-full transition-all transform hover:scale-105 font-medium" data-filter="all">
                        🌃 All (<span id="allCount">0</span>)
                    </button>
                    <button class="filter-btn px-4 py-2 rounded-full transition-all transform hover:scale-105 font-medium" data-filter="critical">
                        ✨ Critical (<span id="criticalCount">0</span>)
                    </button>
                    <button class="filter-btn px-4 py-2 rounded-full transition-all transform hover:scale-105 font-medium" data-filter="coding">
                        🌌 Coding (<span id="codingCount">0</span>)
                    </button>
                    <button class="filter-btn px-4 py-2 rounded-full transition-all transform hover:scale-105 font-medium" data-filter="deployment">
                        🪐 Deploy (<span id="deploymentCount">0</span>)
                    </button>
                    <button class="filter-btn px-4 py-2 rounded-full transition-all transform hover:scale-105 font-medium" data-filter="content">
                        🌙 Content (<span id="contentCount">0</span>)
                    </button>
                    <button class="filter-btn px-4 py-2 rounded-full transition-all transform hover:scale-105 font-medium" data-filter="research">
                        🔮 Research (<span id="researchCount">0</span>)
                    </button>
                </div>

                <!-- Workflow list -->
                <div class="space-y-4" id="workflowsList">
                    <!-- Content will be dynamically inserted here -->
                </div>

                <!-- Bottom celestial decorations -->
                <div class="absolute bottom-2 left-4 text-sky-300 text-lg">🫧</div>
                <div class="absolute bottom-2 right-4 text-pink-300 text-lg">✨</div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let workflows = [
            {
                id: 1,
                title: "Deploy to Production",
                category: "deployment",
                critical: true,
                trigger: "When code has been reviewed, tested, and approved for release",
                steps: [
                    { id: 1, description: "Run test suite locally", notes: "npm test", completed: false },
                    { id: 2, description: "Create pull request", notes: "Include deployment checklist", completed: false },
                    { id: 3, description: "Wait for code review approval", notes: "", completed: false },
                    { id: 4, description: "Deploy to staging", notes: "Test all critical paths", completed: false },
                    { id: 5, description: "Deploy to production", notes: "Monitor for 15 minutes after", completed: false }
                ],
            },
            {
                id: 2,
                title: "Historical Document Analysis",
                category: "research",
                critical: false,
                trigger: "When analyzing primary historical sources for authenticity and context",
                steps: [
                    { id: 1, description: "Identify primary source materials", notes: "Archives, manuscripts, contemporary accounts", completed: false },
                    { id: 2, description: "Verify document authenticity and provenance", notes: "Cross-reference with known collections", completed: false },
                    { id: 3, description: "Contextualize within historical period", notes: "Political, social, economic factors", completed: false },
                    { id: 4, description: "Cross-reference with secondary sources", notes: "Academic papers, other historians' work", completed: false }
                ],
            },
        ];

        let currentFilter = 'all';
        let expandedWorkflows = new Set([1]);

        // Utility functions
        function generateId() {
            return Date.now() + Math.random();
        }

        function updateCounts() {
            document.getElementById('allCount').textContent = workflows.length;
            document.getElementById('criticalCount').textContent = workflows.filter(w => w.critical).length;
            document.getElementById('codingCount').textContent = workflows.filter(w => w.category === 'coding').length;
            document.getElementById('deploymentCount').textContent = workflows.filter(w => w.category === 'deployment').length;
            document.getElementById('contentCount').textContent = workflows.filter(w => w.category === 'content').length;
            document.getElementById('researchCount').textContent = workflows.filter(w => w.category === 'research').length;
        }

        function updateFilterButtons() {
            const buttons = document.querySelectorAll('.filter-btn');
            buttons.forEach(btn => {
                const filter = btn.dataset.filter;
                if (currentFilter === filter) {
                    btn.className = "filter-btn px-4 py-2 rounded-full transition-all transform hover:scale-105 font-medium bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg";
                } else {
                    btn.className = "filter-btn px-4 py-2 rounded-full transition-all transform hover:scale-105 font-medium bg-blue-100 text-blue-700 hover:bg-blue-200";
                }
            });
        }

        function getCategoryColor(category) {
            const colors = {
                coding: "from-blue-500 to-indigo-600",
                deployment: "from-purple-500 to-pink-600",
                content: "from-teal-500 to-cyan-600",
                research: "from-indigo-500 to-purple-600"
            };
            return colors[category] || "from-blue-500 to-purple-600";
        }

        function filterWorkflows() {
            return workflows.filter(workflow => {
                if (currentFilter === "critical") return workflow.critical;
                if (currentFilter === "coding") return workflow.category === "coding";
                if (currentFilter === "deployment") return workflow.category === "deployment";
                if (currentFilter === "content") return workflow.category === "content";
                if (currentFilter === "research") return workflow.category === "research";
                return true;
            });
        }

        function createWorkflowElement(workflow) {
            const isExpanded = expandedWorkflows.has(workflow.id);
            const completedSteps = workflow.steps.filter(s => s.completed).length;
            const progress = workflow.steps.length > 0 ? (completedSteps / workflow.steps.length) * 100 : 0;
            
            return `
                <div class="workflow-card">
                    <div class="bg-gradient-to-r ${getCategoryColor(workflow.category)} p-1 rounded-2xl shadow-lg ${workflow.critical ? 'ring-4 ring-yellow-400 ring-opacity-50' : ''}">
                        <div class="bg-white rounded-xl p-4">
                            ${workflow.critical ? `
                                <div class="mb-3 inline-flex items-center gap-1 bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full font-bold">
                                    <span>⚡</span>
                                    <span>CRITICAL</span>
                                </div>
                            ` : ''}
                            
                            <div class="flex items-center justify-between mb-3">
                                <div class="flex items-center gap-3 flex-1 cursor-pointer" onclick="toggleExpanded(${workflow.id})">
                                    <button class="w-10 h-10 rounded-full bg-gradient-to-r ${getCategoryColor(workflow.category)} text-white flex items-center justify-center transform transition-transform hover:scale-110 ${isExpanded ? 'rotate-90' : ''}">
                                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M9 5l7 7-7 7"></path>
                                        </svg>
                                    </button>
                                    <div class="flex-1">
                                        <h3 class="text-lg font-bold text-gray-800">
                                            ${workflow.title}
                                        </h3>
                                        ${workflow.steps.length > 0 ? `
                                            <div class="flex items-center gap-2 mt-1">
                                                <div class="flex-1 bg-blue-100 rounded-full h-2">
                                                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all" style="width: ${progress}%"></div>
                                                </div>
                                                <span class="text-sm text-blue-600 font-medium">
                                                    ${completedSteps}/${workflow.steps.length}
                                                </span>
                                            </div>
                                        ` : '<span class="text-sm text-gray-500">No steps yet</span>'}
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-2">
                                    <button
                                        onclick="toggleCritical(${workflow.id})"
                                        class="w-8 h-8 rounded-full transition-all transform hover:scale-110 ${
                                            workflow.critical
                                                ? "bg-yellow-400 text-white shadow-lg"
                                                : "bg-gray-200 hover:bg-yellow-100 text-gray-600"
                                        }"
                                        title="${workflow.critical ? 'Remove critical flag' : 'Mark as critical'}"
                                    >
                                        ⚡
                                    </button>
                                    <select
                                        onchange="setCategory(${workflow.id}, this.value)"
                                        onclick="event.stopPropagation()"
                                        class="px-3 py-1 text-sm border-2 border-blue-200 rounded-full bg-white focus:outline-none focus:ring-2 focus:ring-blue-400 text-gray-700"
                                    >
                                        <option value="coding" ${workflow.category === 'coding' ? 'selected' : ''}>🌌 Coding</option>
                                        <option value="deployment" ${workflow.category === 'deployment' ? 'selected' : ''}>🪐 Deploy</option>
                                        <option value="content" ${workflow.category === 'content' ? 'selected' : ''}>🌙 Content</option>
                                        <option value="research" ${workflow.category === 'research' ? 'selected' : ''}>🔮 Research</option>
                                    </select>
                                    <button
                                        onclick="resetWorkflow(${workflow.id})"
                                        class="w-8 h-8 rounded-full bg-blue-100 hover:bg-blue-200 text-blue-600 transition-all transform hover:scale-110"
                                        title="Reset workflow"
                                    >
                                        ↺
                                    </button>
                                    <button
                                        onclick="deleteWorkflow(${workflow.id})"
                                        class="w-8 h-8 rounded-full bg-red-100 hover:bg-red-200 text-red-600 transition-all transform hover:scale-110"
                                    >
                                        ×
                                    </button>
                                </div>
                            </div>

                            ${isExpanded ? `
                                <div class="mt-4 space-y-4 border-t-2 border-blue-100 pt-4">
                                    <div class="bg-blue-50 p-3 rounded-xl">
                                        <label class="block text-sm font-bold text-blue-700 mb-2">
                                            ⚡ Trigger Conditions:
                                        </label>
                                        <textarea
                                            onchange="updateTrigger(${workflow.id}, this.value)"
                                            onclick="event.stopPropagation()"
                                            placeholder="When should this workflow be used?"
                                            class="w-full px-3 py-2 bg-white border-2 border-blue-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all text-gray-700 resize-none"
                                            rows="2"
                                        >${workflow.trigger || ''}</textarea>
                                    </div>

                                    <div class="flex gap-2 items-center">
                                        <input
                                            type="text"
                                            id="newStep-${workflow.id}"
                                            placeholder="Add a new step..."
                                            class="flex-1 px-4 py-2 bg-white border-2 border-blue-200 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all text-gray-700"
                                            onkeypress="if(event.key==='Enter') { event.stopPropagation(); addStep(${workflow.id}); }"
                                            onclick="event.stopPropagation()"
                                        />
                                        <button
                                            onclick="event.stopPropagation(); addStep(${workflow.id})"
                                            class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-full hover:shadow-lg transition-all transform hover:scale-105 font-bold"
                                        >
                                            Add +
                                        </button>
                                    </div>

                                    <div class="space-y-2">
                                        ${workflow.steps.map((step, index) => `
                                            <div class="flex items-start gap-3 p-3 rounded-xl ${
                                                step.completed 
                                                    ? "bg-green-50 border-2 border-green-200" 
                                                    : "bg-white border-2 border-blue-200"
                                            }">
                                                <button
                                                    onclick="event.stopPropagation(); toggleStep(${workflow.id}, ${step.id})"
                                                    class="mt-1 w-6 h-6 rounded-full flex items-center justify-center transition-all transform hover:scale-110 ${
                                                        step.completed
                                                            ? "bg-green-500 text-white"
                                                            : "bg-blue-200 hover:bg-blue-300 text-blue-600"
                                                    }"
                                                >
                                                    ${step.completed ? '✓' : ''}
                                                </button>
                                                
                                                <div class="flex-1">
                                                    <div class="flex items-start justify-between">
                                                        <span class="font-medium ${
                                                            step.completed
                                                                ? "text-green-700 line-through"
                                                                : "text-gray-800"
                                                        }">
                                                            ${index + 1}. ${step.description}
                                                        </span>
                                                        <button
                                                            onclick="event.stopPropagation(); deleteStep(${workflow.id}, ${step.id})"
                                                            class="w-6 h-6 rounded-full bg-red-100 hover:bg-red-200 text-red-500 transition-all transform hover:scale-110 ml-2"
                                                        >
                                                            ×
                                                        </button>
                                                    </div>
                                                    <input
                                                        type="text"
                                                        value="${step.notes || ''}"
                                                        onchange="updateStepNotes(${workflow.id}, ${step.id}, this.value)"
                                                        onclick="event.stopPropagation()"
                                                        placeholder="Add notes..."
                                                        class="text-sm text-blue-600 mt-1 w-full bg-transparent border-b-2 border-blue-100 focus:border-blue-300 focus:outline-none placeholder-blue-300"
                                                    />
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            const filteredWorkflows = filterWorkflows();
            const workflowsList = document.getElementById('workflowsList');

            if (filteredWorkflows.length === 0) {
                workflowsList.innerHTML = `
                    <div class="text-center py-16 bg-blue-50 rounded-2xl">
                        <div class="text-6xl mb-4">☁️</div>
                        <p class="text-blue-600 font-bold text-lg">
                            ${currentFilter === 'all' 
                                ? 'No workflows yet. Create your first one above!' 
                                : `No ${currentFilter} workflows found.`}
                        </p>
                    </div>
                `;
            } else {
                workflowsList.innerHTML = filteredWorkflows.map(createWorkflowElement).join('');
            }

            updateCounts();
            updateFilterButtons();
        }

        // Workflow management functions
        function addWorkflow() {
            const input = document.getElementById('newWorkflow');
            const title = input.value.trim();
            
            if (title) {
                const newWorkflow = {
                    id: generateId(),
                    title: title,
                    category: "coding",
                    critical: false,
                    trigger: "",
                    steps: [],
                };
                workflows.unshift(newWorkflow);
                expandedWorkflows.add(newWorkflow.id);
                input.value = '';
                render();
                saveToStorage();
            }
        }

        function deleteWorkflow(id) {
            if (confirm('Delete this workflow?')) {
                workflows = workflows.filter(w => w.id !== id);
                expandedWorkflows.delete(id);
                render();
                saveToStorage();
            }
        }

        function toggleCritical(id) {
            workflows = workflows.map(w => 
                w.id === id ? { ...w, critical: !w.critical } : w
            );
            render();
            saveToStorage();
        }

        function setCategory(id, category) {
            workflows = workflows.map(w => 
                w.id === id ? { ...w, category } : w
            );
            render();
            saveToStorage();
        }

        function updateTrigger(id, trigger) {
            workflows = workflows.map(w => 
                w.id === id ? { ...w, trigger } : w
            );
            saveToStorage();
        }

        function toggleExpanded(id) {
            if (expandedWorkflows.has(id)) {
                expandedWorkflows.delete(id);
            } else {
                expandedWorkflows.add(id);
            }
            render();
        }

        function resetWorkflow(id) {
            if (confirm('Reset all steps?')) {
                workflows = workflows.map(w =>
                    w.id === id
                        ? { ...w, steps: w.steps.map(s => ({ ...s, completed: false })) }
                        : w
                );
                render();
                saveToStorage();
            }
        }

        function addStep(workflowId) {
            const input = document.getElementById(`newStep-${workflowId}`);
            const description = input.value.trim();
            
            if (description) {
                workflows = workflows.map(w => {
                    if (w.id === workflowId) {
                        return {
                            ...w,
                            steps: [...w.steps, {
                                id: generateId(),
                                description: description,
                                notes: "",
                                completed: false,
                            }]
                        };
                    }
                    return w;
                });
                render();
                saveToStorage();
            }
        }

        function deleteStep(workflowId, stepId) {
            workflows = workflows.map(w => {
                if (w.id === workflowId) {
                    return {
                        ...w,
                        steps: w.steps.filter(s => s.id !== stepId)
                    };
                }
                return w;
            });
            render();
            saveToStorage();
        }

        function toggleStep(workflowId, stepId) {
            workflows = workflows.map(w => {
                if (w.id === workflowId) {
                    return {
                        ...w,
                        steps: w.steps.map(s =>
                            s.id === stepId ? { ...s, completed: !s.completed } : s
                        )
                    };
                }
                return w;
            });
            render();
            saveToStorage();
        }

        function updateStepNotes(workflowId, stepId, notes) {
            workflows = workflows.map(w => {
                if (w.id === workflowId) {
                    return {
                        ...w,
                        steps: w.steps.map(s =>
                            s.id === stepId ? { ...s, notes } : s
                        )
                    };
                }
                return w;
            });
            saveToStorage();
        }

        function saveToStorage() {
            localStorage.setItem('workflows', JSON.stringify({
                workflows: workflows,
                expandedWorkflows: Array.from(expandedWorkflows)
            }));
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('workflows');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    if (parsed.workflows) workflows = parsed.workflows;
                    if (parsed.expandedWorkflows) expandedWorkflows = new Set(parsed.expandedWorkflows);
                } catch (e) {
                    console.error('Error loading saved workflows:', e);
                }
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add workflow button
            document.getElementById('addWorkflowBtn').addEventListener('click', addWorkflow);
            
            // Enter key on new workflow input
            document.getElementById('newWorkflow').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addWorkflow();
            });

            // Filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    currentFilter = this.dataset.filter;
                    render();
                });
            });

            // Load from storage and render
            loadFromStorage();
            render();
        });
    </script>
</body>
</html>
